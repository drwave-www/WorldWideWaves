package com.worldwidewaves.compose.common

/*
 * Copyright 2025 DrWave
 *
 * WorldWideWaves is an ephemeral mobile app designed to orchestrate human waves through cities and
 * countries. The project aims to transcend physical and cultural
 * boundaries, fostering unity, community, and shared human experience by leveraging real-time
 * coordination and location-based services.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import androidx.compose.material3.LocalTextStyle
import androidx.compose.material3.MaterialTheme
import androidx.compose.runtime.CompositionLocalProvider
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.test.junit4.createComposeRule
import androidx.compose.ui.test.onNodeWithText
import androidx.compose.ui.text.TextStyle
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.sp
import com.worldwidewaves.shared.ui.components.AutoResizeSingleLineText
import org.junit.Rule
import org.junit.Test

/**
 * Comprehensive tests for TextUtils functionality including
 * auto-resizing text behavior, font scaling, and layout handling.
 */
class TextUtilsTest {

    @get:Rule
    val composeTestRule = createComposeRule()

    @Test
    fun `test AutoResizeSingleLineText renders text`() {
        val testText = "Hello World"
        val testStyle = TextStyle(fontSize = 16.sp)

        composeTestRule.setContent {
            CompositionLocalProvider(LocalTextStyle provides testStyle) {
                AutoResizeSingleLineText(
                    text = testText,
                    style = testStyle
                )
            }
        }

        composeTestRule.onNodeWithText(testText).assertExists()
    }

    @Test
    fun `test AutoResizeSingleLineText with empty text`() {
        val emptyText = ""
        val testStyle = TextStyle(fontSize = 16.sp)

        composeTestRule.setContent {
            AutoResizeSingleLineText(
                text = emptyText,
                style = testStyle
            )
        }

        // Empty text should still render without crashing
        composeTestRule.onNodeWithText(emptyText).assertExists()
    }

    @Test
    fun `test AutoResizeSingleLineText with long text`() {
        val longText = "This is a very long text that should potentially trigger auto-resizing behavior"
        val testStyle = TextStyle(fontSize = 24.sp)

        composeTestRule.setContent {
            AutoResizeSingleLineText(
                text = longText,
                style = testStyle
            )
        }

        composeTestRule.onNodeWithText(longText).assertExists()
    }

    @Test
    fun `test AutoResizeSingleLineText with custom color`() {
        val testText = "Colored Text"
        val testStyle = TextStyle(fontSize = 16.sp)
        val testColor = Color.Red

        composeTestRule.setContent {
            AutoResizeSingleLineText(
                text = testText,
                style = testStyle,
                color = testColor
            )
        }

        composeTestRule.onNodeWithText(testText).assertExists()
    }

    @Test
    fun `test AutoResizeSingleLineText with different text alignments`() {
        val testText = "Aligned Text"
        val testStyle = TextStyle(fontSize = 16.sp)

        // Test different alignments
        val alignments = listOf(
            TextAlign.Start,
            TextAlign.Center,
            TextAlign.End,
            TextAlign.Justify
        )

        alignments.forEach { alignment ->
            composeTestRule.setContent {
                AutoResizeSingleLineText(
                    text = testText,
                    style = testStyle,
                    textAlign = alignment
                )
            }

            composeTestRule.onNodeWithText(testText).assertExists()
        }
    }

    @Test
    fun `test AutoResizeSingleLineText with custom minimum font size`() {
        val testText = "Minimum Font Size Test"
        val testStyle = TextStyle(fontSize = 16.sp)
        val minFontSize = 12f

        composeTestRule.setContent {
            AutoResizeSingleLineText(
                text = testText,
                style = testStyle,
                minFontSizeSp = minFontSize
            )
        }

        composeTestRule.onNodeWithText(testText).assertExists()
    }

    @Test
    fun `test AutoResizeSingleLineText with custom step scale`() {
        val testText = "Step Scale Test"
        val testStyle = TextStyle(fontSize = 16.sp)
        val stepScale = 0.8f

        composeTestRule.setContent {
            AutoResizeSingleLineText(
                text = testText,
                style = testStyle,
                stepScale = stepScale
            )
        }

        composeTestRule.onNodeWithText(testText).assertExists()
    }

    @Test
    fun `test AutoResizeSingleLineText with special characters`() {
        val specialText = "Special: !@#$%^&*()_+-=[]{}|;':\",./<>?"
        val testStyle = TextStyle(fontSize = 16.sp)

        composeTestRule.setContent {
            AutoResizeSingleLineText(
                text = specialText,
                style = testStyle
            )
        }

        composeTestRule.onNodeWithText(specialText).assertExists()
    }

    @Test
    fun `test AutoResizeSingleLineText with unicode characters`() {
        val unicodeText = "Unicode: ä½ å¥½ä¸–ç•Œ ðŸŒ Ø§Ù„Ø¹Ø§Ù„Ù… Ð¼Ð¸Ñ€"
        val testStyle = TextStyle(fontSize = 16.sp)

        composeTestRule.setContent {
            AutoResizeSingleLineText(
                text = unicodeText,
                style = testStyle
            )
        }

        composeTestRule.onNodeWithText(unicodeText).assertExists()
    }

    @Test
    fun `test AutoResizeSingleLineText with numbers and symbols`() {
        val numericText = "Numbers: 123456789 Symbols: Â±âˆžâ‰ â‰¤â‰¥âˆ‘âˆ"
        val testStyle = TextStyle(fontSize = 16.sp)

        composeTestRule.setContent {
            AutoResizeSingleLineText(
                text = numericText,
                style = testStyle
            )
        }

        composeTestRule.onNodeWithText(numericText).assertExists()
    }

    @Test
    fun `test AutoResizeSingleLineText with MaterialTheme integration`() {
        val testText = "Material Theme Test"

        composeTestRule.setContent {
            MaterialTheme {
                AutoResizeSingleLineText(
                    text = testText,
                    style = MaterialTheme.typography.headlineMedium
                )
            }
        }

        composeTestRule.onNodeWithText(testText).assertExists()
    }

    @Test
    fun `test AutoResizeSingleLineText edge case values`() {
        val testText = "Edge Case"
        val testStyle = TextStyle(fontSize = 16.sp)

        // Test with very small minimum font size
        composeTestRule.setContent {
            AutoResizeSingleLineText(
                text = testText,
                style = testStyle,
                minFontSizeSp = 1f
            )
        }
        composeTestRule.onNodeWithText(testText).assertExists()

        // Test with step scale at boundaries
        composeTestRule.setContent {
            AutoResizeSingleLineText(
                text = testText,
                style = testStyle,
                stepScale = 0.1f
            )
        }
        composeTestRule.onNodeWithText(testText).assertExists()

        composeTestRule.setContent {
            AutoResizeSingleLineText(
                text = testText,
                style = testStyle,
                stepScale = 0.99f
            )
        }
        composeTestRule.onNodeWithText(testText).assertExists()
    }

    @Test
    fun `test AutoResizeSingleLineText with very large font size`() {
        val testText = "Large Font"
        val testStyle = TextStyle(fontSize = 100.sp)

        composeTestRule.setContent {
            AutoResizeSingleLineText(
                text = testText,
                style = testStyle
            )
        }

        composeTestRule.onNodeWithText(testText).assertExists()
    }

    @Test
    fun `test AutoResizeSingleLineText behavior consistency`() {
        val shortText = "Short"
        val mediumText = "Medium length text"
        val longText = "This is a very long text that definitely exceeds normal width constraints"
        val testStyle = TextStyle(fontSize = 16.sp)

        // All should render successfully regardless of length
        listOf(shortText, mediumText, longText).forEach { text ->
            composeTestRule.setContent {
                AutoResizeSingleLineText(
                    text = text,
                    style = testStyle
                )
            }

            composeTestRule.onNodeWithText(text).assertExists()
        }
    }

    @Test
    fun `test AutoResizeSingleLineText with whitespace handling`() {
        val whitespaceTests = listOf(
            " Leading space",
            "Trailing space ",
            " Both spaces ",
            "Multiple    spaces",
            "\tTab character",
            "New\nline", // Should be treated as single line
            ""
        )

        val testStyle = TextStyle(fontSize = 16.sp)

        whitespaceTests.forEach { text ->
            composeTestRule.setContent {
                AutoResizeSingleLineText(
                    text = text,
                    style = testStyle
                )
            }

            composeTestRule.onNodeWithText(text).assertExists()
        }
    }

    @Test
    fun `test AutoResizeSingleLineText parameter validation`() {
        val testText = "Parameter Test"
        val testStyle = TextStyle(fontSize = 16.sp)

        // Test with extreme parameter values that should still work
        composeTestRule.setContent {
            AutoResizeSingleLineText(
                text = testText,
                style = testStyle,
                minFontSizeSp = 0f, // Edge case: zero minimum
                stepScale = 1f // Edge case: no scaling
            )
        }

        composeTestRule.onNodeWithText(testText).assertExists()
    }
}